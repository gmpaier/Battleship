document.addEventListener("DOMContentLoaded",()=>{function a(a,b){for(let c=0;c<k;c++){const d=[];for(let b=0;b<k;b++){const e=document.createElement("div");e.setAttribute("value",`[${c},${b}]`),a.appendChild(e),d.push(e)}b.push(d)}}function b(a){let c,d={name:a.name,position:[],hits:[]},e=Math.floor(2*Math.random()),f=Math.floor(Math.random()*(k-a.coord.length)),g=Math.floor(Math.random()*k);0===e&&(c=a.coord.some(a=>h[g][f+a].classList.contains("reserved"))),1===e&&(c=a.coord.some(a=>h[f+a][g].classList.contains("reserved"))),c?b(a):(0===e?a.coord.forEach(b=>{h[g][f+b].classList.add("reserved",a.name),console.log(h[g][f+b]);let c=JSON.parse(h[g][f+b].getAttribute("value")),e=JSON.stringify(c);d.position.push(e),d.hits.push(0)}):a.coord.forEach(b=>{h[f+b][g].classList.add("reserved",a.name),console.log(h[f+b][g]);let c=JSON.parse(h[f+b][g].getAttribute("value")),e=JSON.stringify(c);d.position.push(e),d.hits.push(0)}),d.position=JSON.stringify(d.position),m.push(d))}async function c(){const a=await fetch("/api/games/play",{method:"GET",headers:{"Content-Type":"application/json"}});if(a.ok){const b=await a.json();"yes"===b.message?d():e()}else alert(a.statusText)}async function d(){console.log("in async");const a=await fetch("/api/games/start",{method:"POST",headers:{"Content-Type":"application/json"}});a.ok?document.location.replace("/game/play"):alert(responseData.statusText)}function e(){setTimeout(function(){c()},3500)}const f=document.querySelector(".grid-user"),g=document.querySelector(".grid-op"),h=[],k=10,l=[{name:"destroyer",coord:[0,1]},{name:"cruise",coord:[0,1,2]},{name:"submarine",coord:[0,1,2]},{name:"battleship",coord:[0,1,2,3]},{name:"carrier",coord:[0,1,2,3,4]}],m=[];a(f,h),a(g,[]),async function(){const a=await fetch("/api/games/set",{method:"GET",headers:{"Content-Type":"application/json"}});if(a.ok){const d=await a.json();console.log(d),!0===d.set?($("#start").prop("disabled",!0),$("#reset").prop("disabled",!0),c()):l.forEach(a=>{b(a)})}}(),$(document).on("click","#reset",function(){h.forEach(a=>{a.forEach(a=>{a.className=""})}),m.splice(0,m.length),l.forEach(a=>{b(a)})}),$(document).on("click","#start",async function(){if(0<m.length){const a=await fetch("/api/games/ships",{method:"POST",body:JSON.stringify({ships:m}),headers:{"Content-Type":"application/json"}});a.ok?($("#start").prop("disabled",!0),$("#reset").prop("disabled",!0),c()):alert(a.statusText)}})});