document.addEventListener("DOMContentLoaded",()=>{function a(a,b){for(let c=0;c<p;c++)for(let d=0;d<p;d++)b.forEach(b=>{let e=JSON.parse(b.position),f=JSON.parse(e);f.forEach(e=>{e=JSON.parse(e),e[0]===c&&e[1]===d&&a[c][d].classList.add(b.name)})})}function b(a,b){for(let c=0;c<p;c++)for(let d=0;d<p;d++)b&&b.forEach(b=>{if(b.row===c&&b.col===d){a[c][d].textContent=!0===b.hit?"O":"X";let e=$(a[c][d]);e.css("pointer-events","none")}})}function c(a,b){for(let c=0;c<p;c++)for(let d=0;d<p;d++)b&&b.forEach(b=>{b.row===c&&b.col===d&&(!0===b.hit?a[c][d].textContent="O":a[c][d].textContent="X")})}async function d(){const a=await fetch("/api/games/status",{method:"GET",headers:{"Content-Type":"application/json"}}),b=await a.json();return b}async function e(){let{game:a,player_id:e,myShots:g,opShots:k,myName:l,opName:m,lastShot:q}=await d();if(c(n,k),b(o,g),q&&f(q),a.winner_id){for(i=0;i<p;i++)for(j=0;j<p;j++){let a=$(o[i][j]);a.css("pointer-events","none")}return void(a.winner_id===e?$(".game-header").text(l+" Won!"):$(".game-header").text(m+" Won!"))}if(a.turn===e)for($(".game-header").text(l+"'s Turn"),i=0;i<p;i++)for(j=0;j<p;j++)g.forEach(a=>{if(a.row===i&&a.col===j);else{let a=$(o[i][j]);a.removeAttr("style")}});else{for($(".game-header").text(m+"'s Turn"),i=0;i<p;i++)for(j=0;j<p;j++){let a=$(o[i][j]);a.css("pointer-events","none")}h()}}function f(a){!0===a.hit?$(".status-text").text(`Hit at [${a.row},${a.col}]`):$(".status-text").text(`Miss at [${a.row},${a.col}]`),!1===q?$(".status-ship").text(""):q=!1}function g(a){q=!0,$(".status-ship").text(`Enemy ${a} destroyed!`)}function h(){setTimeout(function(){e()},3500)}async function k(){const a=await fetch("/api/games/isWinner",{method:"POST",headers:{"Content-Type":"application/json"}});a.ok||alert(a.statusText)}const l=document.querySelector(".grid-user"),m=document.querySelector(".grid-op"),n=[],o=[],p=10;let q=!1;(function(a,b){for(let c=0;c<p;c++){const d=[];for(let b=0;b<p;b++){const e=document.createElement("div");e.setAttribute("value",`[${c},${b}]`);let f=$(e);f.addClass("my-square"),a.appendChild(e),d.push(e)}b.push(d)}})(l,n),function(a,b){for(let c=0;c<p;c++){const d=[];for(let b=0;b<p;b++){const e=document.createElement("div");e.setAttribute("value",`[${c},${b}]`);let f=$(e);f.addClass("op-square"),a.appendChild(e),d.push(e)}b.push(d)}}(m,o),async function(){const b=await fetch("/api/games/ships",{method:"GET",headers:{"Content-Type":"application/json"}}),c=await b.json();let d=c.ships;return a(n,d)}(),e(),$(document).on("click",".op-square",async function(){let a=$(this).attr("value"),b=JSON.parse(a);const c=await fetch("/api/games/shot",{method:"POST",body:JSON.stringify({shot:b}),headers:{"Content-Type":"application/json"}});if(console.log(c),c.ok){let a=await c.json();a.name&&(k(),g(a.name)),e()}else alert(c.statusText)})});